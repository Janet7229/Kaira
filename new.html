<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Swimmer Registration</title>
  <!-- Tailwind CSS -->
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-100 min-h-screen flex items-center justify-center p-6">
  <div class="bg-white shadow-lg rounded-2xl p-6 w-full max-w-3xl">
    <h1 class="text-2xl font-bold mb-4">Swimmer Registration</h1>

    <!-- Form -->
    <form id="swimmerForm" class="grid grid-cols-1 md:grid-cols-2 gap-4">
      <input type="text" id="name" placeholder="Name" class="p-2 border rounded" required>
      <input type="number" id="age" placeholder="Age" class="p-2 border rounded" required>
      <input type="text" id="gender" placeholder="Gender" class="p-2 border rounded" required>
      <input type="text" id="event" placeholder="Event" class="p-2 border rounded" required>
      <input type="number" id="time" placeholder="Best Time (seconds)" class="p-2 border rounded" required>
      
      <button type="submit" class="bg-blue-500 text-white px-4 py-2 rounded">Add Swimmer</button>
    </form>

    <!-- Messages -->
    <div id="message" class="mt-4 text-sm"></div>

    <!-- Swimmer List -->
    <h2 class="text-xl font-semibold mt-6">Swimmers List</h2>
    <ul id="swimmerList" class="mt-2 space-y-2"></ul>

    <!-- Bulk Submit -->
    <button id="bulkSubmitBtn" class="mt-6 w-full bg-green-600 text-white px-4 py-2 rounded">
      Bulk Submit All Swimmers
    </button>
  </div>

  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
    import { getAuth, signInAnonymously } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
    import { getFirestore, collection, addDoc } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";

    // --- Firebase Config ---
    const firebaseConfig = {
      apiKey: "AIzaSyCZt6KtFQmU1U8ae7dwa3F4MMtVEY_2AiY",
      authDomain: "swimmingcompetition-91229.firebaseapp.com",
      projectId: "swimmingcompetition-91229",
      storageBucket: "swimmingcompetition-91229.firebasestorage.app",
      messagingSenderId: "1040379968158",
      appId: "1:1040379968158:web:07d232b63116790053598f"
    };

    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);
    const auth = getAuth(app);

    // Sign in anonymously
    await signInAnonymously(auth);

    // --- State ---
    let allSwimmersData = [];

    // Elements
    const form = document.getElementById("swimmerForm");
    const swimmerList = document.getElementById("swimmerList");
    const messageDiv = document.getElementById("message");
    const bulkSubmitBtn = document.getElementById("bulkSubmitBtn");

    // Show message
    function showMessage(msg, isError = false) {
      messageDiv.textContent = msg;
      messageDiv.className = isError ? "text-red-600 mt-4" : "text-green-600 mt-4";
    }

    // Render swimmer list
    function renderSwimmersList() {
      swimmerList.innerHTML = "";
      allSwimmersData.forEach((swimmer, index) => {
        const li = document.createElement("li");
        li.className = "p-3 bg-gray-200 rounded flex justify-between items-center";
        li.innerHTML = `
          <span>${swimmer.name}, ${swimmer.age}y, ${swimmer.gender}, ${swimmer.event}, ${swimmer.time}s</span>
          <button class="text-red-600" onclick="removeSwimmer(${index})">❌</button>
        `;
        swimmerList.appendChild(li);
      });
    }

    // Remove swimmer
    window.removeSwimmer = function(index) {
      allSwimmersData.splice(index, 1);
      renderSwimmersList();
    };

    // Handle form submit
    form.addEventListener("submit", (e) => {
      e.preventDefault();
      const swimmer = {
        name: document.getElementById("name").value,
        age: parseInt(document.getElementById("age").value),
        gender: document.getElementById("gender").value,
        event: document.getElementById("event").value,
        time: parseFloat(document.getElementById("time").value),
      };
      allSwimmersData.push(swimmer);
      renderSwimmersList();
      form.reset();
    });

    // Handle bulk submit
    bulkSubmitBtn.addEventListener("click", async () => {
      if (allSwimmersData.length === 0) {
        showMessage("No swimmers to submit!", true);
        return;
      }

      bulkSubmitBtn.disabled = true;
      bulkSubmitBtn.textContent = "Submitting...";

      try {
        for (const swimmer of allSwimmersData) {
          await addDoc(collection(db, "swimmer"), swimmer);
        }
        showMessage(`✅ Submitted ${allSwimmersData.length} swimmer(s) successfully!`);
        allSwimmersData = [];
        renderSwimmersList();
      } catch (err) {
        console.error(err);
        showMessage(`❌ Error: ${err.message}`, true);
      } finally {
        bulkSubmitBtn.disabled = false;
        bulkSubmitBtn.textContent = "Bulk Submit All Swimmers";
      }
    });
  </script>
</body>
</html>
